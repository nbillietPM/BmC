#Use ncdf4 to read the cube

install.packages("ncdf4")
library(ncdf4)

nc <- nc_open("~/Repositories/BmC/scripts/prototype/debug/chelsa_reference_cube_test.nc")

# Get variable names
names(nc$var)
# [1] "bio1"  "bio2"  "bio3"  "bio4"  "bio5"  "bio6"  "bio7"  "bio8"  "bio9"  "bio10" "bio11" "bio12" "bio13" "bio14"
#[15] "bio15" "bio16" "bio17" "bio18" "bio19


# Get dimension names
names(nc$dim)
#[1] "lat"  "long"

# Read a variable
data <- ncvar_get(nc, "bio1")

print(data)
"
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13] [,14] [,15] [,16] [,17] [,18] [,19] [,20]
 [1,] 2837 2836 2836 2835 2834 2834 2835 2835 2836  2836  2836  2836  2836  2836  2836  2835  2835  2835  2834  2834
 [2,] 2837 2836 2836 2835 2835 2834 2836 2835 2836  2836  2836  2836  2836  2836  2836  2835  2836  2835  2835  2835
 [3,] 2837 2836 2836 2836 2834 2834 2836 2835 2835  2836  2836  2836  2837  2836  2836  2836  2836  2835  2834  2835
 [4,] 2836 2836 2836 2836 2834 2835 2836 2835 2834  2835  2836  2837  2836  2835  2835  2835  2836  2836  2835  2835
 [5,] 2836 2836 2836 2836 2835 2836 2836 2835 2835  2835  2836  2837  2836  2835  2835  2835  2836  2836  2835  2836
 [6,] 2836 2836 2836 2836 2835 2836 2836 2835 2835  2835  2836  2836  2836  2835  2836  2836  2836  2836  2835  2836
 [7,] 2836 2836 2835 2835 2835 2836 2836 2836 2836  2835  2836  2837  2836  2835  2836  2836  2836  2836  2836  2836
 [8,] 2836 2836 2835 2834 2835 2836 2836 2836 2836  2836  2836  2836  2836  2836  2836  2836  2836  2836  2836  2836
 [9,] 2836 2836 2836 2834 2835 2836 2836 2836 2836  2836  2836  2836  2836  2836  2836  2836  2836  2836  2835  2835
[10,] 2836 2836 2835 2834 2835 2836 2836 2836 2836  2836  2837  2836  2836  2837  2836  2836  2836  2835  2835  2834
[11,] 2836 2835 2834 2834 2835 2836 2836 2836 2836  2836  2836  2836  2836  2837  2837  2836  2835  2835  2833  2833
[12,] 2836 2836 2835 2834 2836 2836 2836 2837 2836  2837  2837  2836  2837  2837  2837  2836  2835  2834  2833  2833
[13,] 2836 2836 2835 2835 2836 2836 2836 2836 2837  2837  2836  2837  2837  2837  2836  2836  2835  2834  2834  2833
[14,] 2836 2836 2834 2835 2836 2836 2837 2837 2837  2837  2837  2837  2837  2836  2836  2834  2835  2835  2835  2833
[15,] 2836 2836 2834 2835 2836 2836 2837 2837 2837  2837  2837  2837  2837  2836  2836  2834  2835  2835  2835  2833
[16,] 2836 2835 2835 2835 2836 2837 2837 2837 2837  2837  2837  2837  2837  2836  2835  2833  2835  2835  2833  2832
[17,] 2835 2835 2835 2836 2836 2837 2837 2837 2837  2837  2837  2837  2836  2835  2834  2833  2834  2835  2834  2833
[18,] 2835 2836 2836 2836 2837 2837 2837 2837 2837  2837  2837  2836  2834  2833  2833  2833  2833  2835  2834  2833
[19,] 2836 2836 2836 2836 2837 2837 2837 2836 2836  2837  2836  2836  2834  2833  2832  2832  2834  2834  2834  2832
[20,] 2836 2836 2837 2837 2837 2837 2836 2834 2835  2836  2836  2835  2835  2833  2832  2833  2834  2833  2834  2832
[21,] 2836 2837 2837 2837 2837 2836 2834 2834 2835  2835  2835  2834  2834  2833  2832  2834  2834  2833  2832  2832
[22,] 2837 2837 2837 2837 2836 2835 2833 2833 2835  2834  2834  2833  2833  2833  2833  2834  2833  2832  2832  2832
[23,] 2837 2837 2837 2836 2835 2834 2834 2833 2834  2834  2834  2833  2834  2833  2834  2834  2833  2832  2832  2832
[24,] 2837 2837 2836 2835 2834 2834 2834 2833 2833  2833  2834  2832  2833  2833  2833  2833  2832  2832  2832  2832
[25,] 2837 2836 2835 2835 2834 2834 2834 2833 2832  2833  2833  2832  2833  2832  2833  2833  2832  2832  2833  2833
[26,] 2837 2836 2836 2835 2835 2834 2834 2833 2833  2833  2833  2832  2832  2832  2832  2833  2833  2832  2833  2832
[27,] 2836 2835 2834 2834 2835 2834 2834 2833 2833  2832  2832  2831  2831  2831  2832  2833  2832  2832  2832  2832
[28,] 2835 2835 2834 2833 2834 2834 2833 2834 2834  2833  2832  2831  2832  2831  2832  2832  2832  2832  2832  2832
[29,] 2835 2835 2834 2833 2834 2834 2833 2834 2834  2833  2832  2832  2832  2832  2832  2831  2831  2832  2832  2832
[30,] 2835 2834 2834 2834 2834 2834 2834 2834 2833  2834  2833  2831  2832  2832  2831  2831  2832  2832  2832  2833
[31,] 2835 2834 2834 2835 2834 2834 2834 2835 2834  2834  2833  2832  2832  2832  2832  2831  2831  2832  2832  2833
[32,] 2835 2835 2834 2835 2835 2835 2835 2835 2834  2832  2832  2832  2832  2832  2832  2831  2831  2832  2832  2833
[33,] 2835 2834 2835 2836 2835 2835 2834 2834 2833  2832  2831  2832  2832  2832  2831  2831  2832  2833  2833  2833
[34,] 2835 2835 2836 2835 2835 2834 2833 2834 2833  2832  2832  2832  2833  2832  2832  2831  2832  2834  2834  2833
[35,] 2836 2836 2835 2835 2834 2834 2833 2833 2833  2832  2832  2832  2833  2833  2831  2832  2833  2834  2834  2833
[36,] 2835 2836 2834 2835 2835 2834 2832 2833 2832  2832  2832  2832  2833  2833  2832  2832  2834  2834  2834  2833
[37,] 2835 2836 2835 2834 2834 2833 2832 2833 2832  2832  2832  2833  2834  2834  2832  2833  2834  2833  2834  2833
[38,] 2835 2835 2835 2834 2834 2833 2832 2832 2832  2832  2832  2832  2834  2833  2833  2834  2834  2834  2834  2833
[39,] 2835 2835 2835 2835 2834 2833 2833 2832 2832  2832  2833  2833  2834  2834  2833  2834  2835  2834  2833  2833
[40,] 2835 2835 2835 2835 2834 2833 2834 2833 2832  2832  2832  2832  2834  2833  2833  2834  2834  2834  2833  2834
[41,] 2835 2835 2835 2834 2834 2834 2834 2833 2832  2832  2833  2833  2834  2834  2833  2834  2833  2834  2834  2834
[42,] 2835 2835 2835 2835 2834 2833 2834 2833 2832  2832  2833  2833  2834  2834  2834  2833  2834  2835  2835  2833
[43,] 2835 2835 2834 2834 2834 2834 2834 2833 2832  2833  2833  2833  2834  2833  2833  2833  2834  2835  2834  2833
      [,21] [,22] [,23]
 [1,]  2834  2835  2836
 [2,]  2835  2835  2836
 [3,]  2835  2836  2836
 [4,]  2835  2836  2836
 [5,]  2836  2836  2836
 [6,]  2836  2836  2836
 [7,]  2835  2835  2835
 [8,]  2835  2835  2834
 [9,]  2834  2833  2833
[10,]  2833  2833  2834
[11,]  2832  2833  2834
[12,]  2833  2833  2835
[13,]  2832  2832  2834
[14,]  2831  2832  2833
[15,]  2831  2832  2833
[16,]  2832  2832  2833
[17,]  2832  2832  2834
[18,]  2832  2832  2834
[19,]  2832  2833  2834
[20,]  2832  2834  2834
[21,]  2833  2834  2834
[22,]  2833  2834  2833
[23,]  2833  2834  2833
[24,]  2833  2834  2833
[25,]  2833  2833  2833
[26,]  2832  2833  2833
[27,]  2832  2833  2833
[28,]  2832  2832  2832
[29,]  2832  2832  2832
[30,]  2833  2832  2832
[31,]  2833  2832  2833
[32,]  2832  2833  2832
[33,]  2833  2833  2832
[34,]  2833  2832  2833
[35,]  2833  2832  2833
[36,]  2833  2833  2833
[37,]  2833  2833  2833
[38,]  2833  2834  2833
[39,]  2833  2834  2834
[40,]  2834  2835  2834
[41,]  2834  2833  2833
[42,]  2833  2833  2832
[43,]  2833  2832  2832
"

# Reads the dimension data
lat_data <- ncvar_get(nc, "lat")
print(lat_data)
"
[1] 50.87374 50.86541 50.85708 50.84874 50.84041 50.83208 50.82374 50.81541 50.80708 50.79874 50.79041 50.78208 50.77374
[14] 50.76541 50.75708 50.74874 50.74041 50.73208 50.72374 50.71541 50.70708 50.69874 50.69041
"
long_data <- ncvar_get(nc, "long")
print(long_data)
"
 [1] 4.175538 4.183871 4.192204 4.200538 4.208871 4.217204 4.225538 4.233871 4.242204 4.250538 4.258871 4.267204 4.275538
[14] 4.283871 4.292204 4.300538 4.308871 4.317204 4.325538 4.333871 4.342204 4.350538 4.358871 4.367204 4.375538 4.383871
[27] 4.392204 4.400538 4.408871 4.417204 4.425538 4.433871 4.442204 4.450538 4.458871 4.467204 4.475538 4.483871 4.492204
[40] 4.500538 4.508871 4.517204 4.525538 4.533871 4.542204 4.550538 4.558871 4.567204 4.575538 4.583871 4.592204 4.600538
[53] 4.608871 4.617204 4.625538 4.633871 4.642204 4.650538 4.658871 4.667204 4.675538 4.683871 4.692204 4.700538 4.708871
[66] 4.717204 4.725538 4.733871 4.742204
"
nc$att
ncatt_get(nc, 0)
#$`Reference Period`
#[1] "1981-2010"

nc_close(nc)

#####################################

#Use terra to read the cube

install.packages("terra")
library(terra)

r <- rast("~/Repositories/BmC/scripts/prototype/debug/chelsa_reference_cube_test.nc")

# Print summary
print(r)
"
class       : SpatRaster
size        : 23, 69, 19  (nrow, ncol, nlyr)
resolution  : 0.008333333, 0.008333333  (x, y)
extent      : 4.171371, 4.746371, 50.68624, 50.87791  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat WGS 84 (CRS84) (OGC:CRS84)
sources     : chelsa_reference_cube_test.nc:bio1
              chelsa_reference_cube_test.nc:bio2
              chelsa_reference_cube_test.nc:bio3
              ... and 16 more sources
varnames    : bio1
              bio2
              bio3
              ...
names       : bio1, bio2, bio3, bio4, bio5, bio6, ...
"

# See layer names (e.g., variables or time steps)
names(r)
#[1] "bio1"  "bio2"  "bio3"  "bio4"  "bio5"  "bio6"  "bio7"  "bio8"  "bio9"  "bio10" "bio11" "bio12" "bio13" "bio14"
#[15] "bio15" "bio16" "bio17" "bio18" "bio19"

# Access specific data
values(r[[1]])
"
[1,] 2837
[2,] 2837
[3,] 2837
[4,] 2836
[5,] 2836
[6,] 2836
[7,] 2836
[8,] 2836
[9,] 2836
[10,] 2836
[11,] 2836
[12,] 2836
[13,] 2836
...
"

ext(r)     # Returns extent (bounding box)
#SpatExtent : 4.17137100000002, 4.74637099770002, 50.6862443341, 50.877911 (xmin, xmax, ymin, ymax)

res(r)     # Returns resolution (cell size)
#[1] 0.008333333 0.008333333

writeLines(crs(r))    # Returns coordinate reference system
'
GEOGCRS["WGS 84 (CRS84)",
        DATUM["World Geodetic System 1984",
              ELLIPSOID["WGS 84",6378137,298.257223563,
                        LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
               ANGLEUNIT["degree",0.0174532925199433]],
        CS[ellipsoidal,2],
        AXIS["geodetic longitude (Lon)",east,
             ORDER[1],
             ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic latitude (Lat)",north,
             ORDER[2],
             ANGLEUNIT["degree",0.0174532925199433]],
        USAGE[
          SCOPE["unknown"],
          AREA["World"],
          BBOX[-90,-180,90,180]],
        ID["OGC","CRS84"]]
'
